services:
  # Backend API
  - type: web
    name: chess-backend
    env: node
    buildCommand: cd apps/backend && npm install && cd ../../packages/db && npm install && npx prisma generate && cd ../../apps/backend && npm run build
    startCommand: cd apps/backend && npm start
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: COOKIE_SECRET
        generateValue: true
      - key: ALLOWED_HOSTS
        value: https://your-frontend-url.vercel.app
      - key: NODE_VERSION
        value: 20.11.0

  # WebSocket Server
  - type: web
    name: chess-websocket
    env: node
    buildCommand: cd apps/ws && npm install && cd ../../packages/db && npm install && npx prisma generate && cd ../../apps/ws && npx esbuild ./src/index.ts --bundle --platform=node --outfile=dist/index.js
    startCommand: cd apps/ws && node dist/index.js
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: NODE_VERSION
        value: 20.11.0
